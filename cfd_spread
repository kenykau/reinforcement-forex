from datetime import datetime, time
from typing import List, Dict

'''
CFDSpread is specify the spread for Index CFD trade, in which the spread is time dependent as the trading session of the exchange
'''
class CFDSpread:
    def __init__(self):
        self.spreads:List[Dict] = []
    
    def add_spread(self, begin:time, end:time, spread:float):
        self.spreads.append({
            "begin": begin,
            "end": end,
            "spread": spread
        })
    
    def get_spread(self, dt:datetime)->float:
        t = dt.time()
        result = list(filter(lambda x: t>=x["begin"] and t<=x["end"], self.spreads))
        assert len(result)==1, "None or more than 1 spread found for time: {}".format(dt)
        return result[0]["spread"]

'''
Example:
Taking IG's HK50 CFD contract, the following code illustrate the way to create the spread base on different trading session of the Hangseng Index Session
HK50SPREAD = CFDSpread()
HK50SPREAD.add_spread(begin=time(hour=1, minute=45), end=time(hour=4, minute=0, second=0), spread=5)
HK50SPREAD.add_spread(begin=time(hour=4, minute=0, second=1), end=time(hour=5, minute=49, second=59), spread=30)
HK50SPREAD.add_spread(begin=time(hour=5, minute=50), end=time(hour=9, minute=30, second=0), spread=5)
HK50SPREAD.add_spread(begin=time(hour=9, minute=30, second=1), end=time(hour=10, minute=14, second=59), spread=30)
HK50SPREAD.add_spread(begin=time(hour=10, minute=15), end=time(hour=19, minute=59, second=59), spread=8)
HK50SPREAD.add_spread(begin=time(hour=20, minute=0), end=time(hour=23, minute=59, second=59), spread=30)
HK50SPREAD.add_spread(begin=time(hour=0, minute=0), end=time(hour=1, minute=44, second=59), spread=30)
'''
